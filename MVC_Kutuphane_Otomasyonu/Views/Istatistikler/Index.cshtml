
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<body>
    <div class="page-content fade-in-up">
        <div class="row">
            <div class="col-lg-3 col-md-6">
                <div class="ibox bg-success color-white widget-stat">
                    <div class="ibox-body">
                        <h2 class="m-b-5 font-strong">@ViewBag.GirisSayisi</h2>
                        <div class="m-b-5">En Çok Giriş Yapan Kullanıcı</div><i class="fa fa-user-circle widget-stat-icon"></i>
                        <div><i class="fa fa-level m-r-5"></i><small>@ViewBag.KullaniciAdi</small></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="ibox bg-info color-white widget-stat">
                    <div class="ibox-body">
                        <h2 class="m-b-5 font-strong">@ViewBag.EnCokSayi</h2>
                        <div class="m-b-5">En Çok Kitap Okuyan</div><i class="fa fa-address-book widget-stat-icon"></i>
                        <div><i class="fa fa-level-up m-r-5"></i><small>@ViewBag.EnCokUye</small></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="ibox bg-warning color-white widget-stat">
                    <div class="ibox-body">
                        <h2 class="m-b-5 font-strong">@ViewBag.EnAzSayi</h2>
                        <div class="m-b-5">En Az Kitap Okuyan</div><i class="fa fa-book widget-stat-icon"></i>
                        <div><i class="fa fa-level-up m-r-5"></i><small>@ViewBag.EnAzUye</small></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="ibox bg-danger color-white widget-stat">
                    <div class="ibox-body">
                        <h2 class="m-b-5 font-strong">@ViewBag.Count</h2>
                        <div class="m-b-5">Kullanıcı Sayısı</div><i class="ti-user widget-stat-icon"></i>
                        <div><i class="fa fa-level m-r-5"></i><small></small></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8">
                <div class="ibox">
                    <div class="ibox-body">
                        <div class="flexbox mb-4">
                            <div>
                                <h3 class="m-0">İSTATİSTİKLER</h3>
                                <div>Analizler</div>
                            </div>
                            <div class="d-inline-flex">
                                <div class="px-3" style="border-right: 1px solid rgba(0,0,0,.1);">
                                    <div class="text-muted">Toplam Giriş Sayısı</div>
                                    <div>
                                        <span class="h2 m-0">@ViewBag.ToplamKHGSayisi</span>
                                        <span class="text-success ml-2"><i class="fa fa-level"></i> </span>
                                    </div>
                                </div>
                                <div class="px-3">
                                    <div class="text-muted">SON ALTI AY GİRİŞ SAYISI</div>
                                    <div>
                                        <span class="h2 m-0">@ViewBag.AltiAyToplamKHGSayisi</span>
                                        <span class="text-warning ml-2"><i class="fa fa-level"></i> </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <canvas id="grafikHareket" style="height:260px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="ibox">
                    <div class="ibox-head">
                        <div class="ibox-title">İSTATİSTİKLER</div>
                    </div>
                    <div class="ibox-body">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h6>İlk Üç Üye</h6>
                                <div style="height:250px;">
                                    <canvas id="dairesel_grafik"></canvas>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>
        <script>
            var uyeKitap = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.UyeKitapModel));

             var labels = uyeKitap.map(x => `${x.AdSoyad} %${x.Yuzde.toFixed(2)}`);
             var data = uyeKitap.map(x => x.OkunanKitapSayisi);


             var ctx = document.getElementById('dairesel_grafik').getContext('2d');

            new Chart(ctx, {
             type: 'pie',
             data: {
                 labels: labels,
                 datasets: [{
                    label: 'Okunan Kitap Sayısı',
                    data: data,
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'],
                    borderColor: ['#FF6384', '#36A2EB', '#FFCE56'],
                    borderWidth: 1
                  }]
        },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: {
                        display: true,
                        labels: {
                            generateLabels: function (chart) {
                                var data = chart.data;
                                if (data.labels.length && data.datasets.length) {
                                    return data.labels.map(function (label, i) {
                                        return {
                                            text: label,
                                            fillStyle: data.datasets[0].backgroundColor[i],
                                            hidden: false, // Çizginin çıkmasına neden olan 'true' durumunu engeller
                                            index: i
                                        };
                                    });
                                }
                                return [];
                            }
                        }
                    }
                }
        });

        </script>
        <script>

            var aylikVeri= @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.AylikVeriler));

            var labels= aylikVeri.map(data => `${data.Ay} /${data.Yil}`);

            var hareketSayilari = aylikVeri.map(data => data.HareketSay);

            var grafik= document.getElementById('grafikHareket').getContext('2d');

            new Chart(grafik, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Kullanıcı Girişleri',
                        data: hareketSayilari,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true, 
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        </script>
        <style>
            /* Grafik üzerindeki çizgileri kaldıran kritik bölge */
            #dairesel_grafik, #grafikHareket, canvas, .chartjs-render-monitor {
                text-decoration: none !important;
            }

            /* Temanın etiketlere (label) uyguladığı çizgiyi iptal eder */
            .ibox label, .ibox span, .ibox div {
                text-decoration: none !important;
            }

            /* Mevcut progress bar stillerin (bozma) */
            .visitors-table tbody tr td:last-child {
                display: flex;
                align-items: center;
                min-width: 150px;
            }

            .visitors-table .progress {
                flex: 1;
                height: 8px;
                margin-bottom: 0;
                background-color: #f5f5f5;
                border-radius: 4px;
            }

            .visitors-table .progress-bar {
                transition: width 0.6s ease;
            }

            .visitors-table .progress-parcent {
                text-align: right;
                margin-left: 12px;
                font-size: 12px;
                font-weight: bold;
                color: #555;
                min-width: 45px;
            }
        </style>
    </div>
</body>


